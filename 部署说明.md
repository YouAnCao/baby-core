# Baby Core Docker 部署说明

## 🎯 部署已配置完成！

所有 Docker 部署文件已准备就绪，可以直接部署到您的 Debian 12 服务器。

## 📦 部署配置

- **后端端口**: 8899
- **前端路径**: /baby-core
- **访问地址**: http://your-server-ip/baby-core
- **API 地址**: http://your-server-ip/baby-core/api

## 🚀 快速部署（3 步骤）

### 1️⃣ 上传项目到服务器

```bash
# 在本地打包
cd baby-core
tar -czf baby-core.tar.gz .

# 上传到服务器
scp baby-core.tar.gz user@your-server:/home/user/

# 在服务器上解压
ssh user@your-server
mkdir baby-core && cd baby-core
tar -xzf ../baby-core.tar.gz
```

### 2️⃣ 配置并部署

```bash
# 配置环境变量
cp .env.example .env
nano .env  # 修改 JWT_SECRET

# 一键部署
chmod +x deploy.sh
./deploy.sh
```

### 3️⃣ 创建用户

```bash
# 创建默认用户（admin/admin123）
chmod +x init-user-simple.sh
./init-user-simple.sh
```

## 🌐 访问应用

```
http://your-server-ip/baby-core
```

默认登录：
- 用户名: **admin**
- 密码: **admin123**

⚠️ **请登录后立即修改密码！**

## 📚 详细文档

| 文档 | 说明 |
|------|------|
| **DEPLOY_README.md** | 📖 **从这里开始** - 部署入口文档 |
| QUICKSTART_DOCKER.md | ⚡ 5分钟快速部署 |
| SERVER_SETUP.md | 🖥️ Debian 12 服务器配置 |
| DEPLOYMENT_DOCKER.md | 📋 完整部署指南 |
| DOCKER_DEPLOYMENT_README.md | 🏗️ 架构和配置说明 |
| DEPLOYMENT_SUMMARY.md | 📊 部署总结 |
| DOCKER_DEPLOYMENT_FILES.md | 📁 文件清单 |

## 🔧 主要脚本

| 脚本 | 用途 |
|------|------|
| `deploy.sh` | 一键部署 |
| `init-user-simple.sh` | 创建默认用户 |
| `init-user.sh` | 创建自定义用户 |
| `verify-deployment.sh` | 验证部署 |

## 📊 架构说明

```
用户浏览器
    │
    │ 访问: http://server/baby-core
    ▼
┌─────────────┐
│   Nginx     │ 端口 80
│  (容器)     │ 反向代理
└──────┬──────┘
       │
       │ 代理到: http://baby-core:8899
       ▼
┌─────────────┐
│ Baby-Core   │ 端口 8899
│   后端      │ Go + Vue.js
└──────┬──────┘
       │
       │ 数据存储
       ▼
┌─────────────┐
│   SQLite    │
│  数据库     │ ./data/baby_tracker.db
└─────────────┘
```

## ⚙️ 配置要点

### 必须修改的配置

1. **JWT Secret** (在 `.env` 文件中)
   ```bash
   # 生成强密码
   openssl rand -base64 32
   
   # 写入 .env
   JWT_SECRET=生成的密码
   ```

2. **默认用户密码**
   - 首次登录后立即修改

### 环境变量说明

```env
# .env 文件
JWT_SECRET=your-secret-key-here    # 必须修改！
PORT=8899                          # 后端端口
DB_PATH=/app/data/baby_tracker.db  # 数据库路径
TZ=Asia/Shanghai                   # 时区
```

## 🛠️ 常用命令

```bash
# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f

# 重启服务
docker-compose restart

# 停止服务
docker-compose down

# 更新并重启
docker-compose down
docker-compose up -d --build

# 备份数据
cp data/baby_tracker.db backups/backup-$(date +%Y%m%d).db
```

## ✅ 部署验证

```bash
# 运行验证脚本
./verify-deployment.sh

# 应该看到：
# ✓ Docker 已安装
# ✓ Baby Core 容器运行中
# ✓ Nginx 容器运行中
# ✓ 后端服务响应正常
# ✓ 前端服务响应正常
# 🎉 所有检查通过！部署成功！
```

## 🔒 安全建议

### 必须做

- ✅ 修改 `.env` 中的 `JWT_SECRET`
- ✅ 修改默认密码 `admin123`
- ✅ 配置防火墙，只开放必要端口

### 建议做

- ⭐ 配置 HTTPS (使用 Let's Encrypt 免费证书)
- ⭐ 设置定期数据备份
- ⭐ 定期更新系统和 Docker 镜像

### 防火墙配置

```bash
# 安装防火墙
sudo apt install ufw

# 配置规则
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# 启用防火墙
sudo ufw enable
```

## 📱 功能说明

### 主要功能

- 👶 **宝宝记录**: 喂奶、换尿布、睡眠、体温等
- 📊 **数据统计**: 每日、每周统计分析
- ⏱️ **计时器**: 喂奶计时、睡眠计时
- 📱 **移动友好**: 响应式设计，支持手机访问

### 访问路径

- 首页: `/baby-core`
- 登录: `/baby-core/login`
- API: `/baby-core/api/*`

## 🆘 故障排查

### 无法访问

```bash
# 检查容器状态
docker-compose ps

# 检查防火墙
sudo ufw status

# 查看日志
docker-compose logs -f
```

### 登录失败

```bash
# 重新创建用户
./init-user-simple.sh
```

### 数据库错误

```bash
# 检查权限
ls -la data/

# 重新初始化（会丢失数据！）
docker-compose down
rm -f data/baby_tracker.db
docker-compose up -d
./init-user-simple.sh
```

## 📞 需要帮助？

1. **查看日志**: `docker-compose logs -f`
2. **运行验证**: `./verify-deployment.sh`
3. **查阅文档**: 参考上面列出的详细文档
4. **重新部署**: `./deploy.sh`

## 🎓 学习路径

### 快速开始用户
```
DEPLOY_README.md → QUICKSTART_DOCKER.md → 执行部署 → 完成！
```

### 生产环境用户
```
DEPLOY_README.md → SERVER_SETUP.md → DEPLOYMENT_DOCKER.md → 完成！
```

## 📝 下一步

1. ✅ 完成部署
2. ✅ 创建用户
3. ✅ 登录并修改密码
4. ✅ 熟悉功能
5. ✅ 配置 HTTPS（可选）
6. ✅ 设置备份（可选）
7. ✅ 邀请家人使用

## 🎉 开始使用

现在您已经了解了所有部署信息！

**立即开始** → 阅读 [`DEPLOY_README.md`](./DEPLOY_README.md)

或者直接执行快速部署：

```bash
cp .env.example .env && nano .env
chmod +x deploy.sh && ./deploy.sh
chmod +x init-user-simple.sh && ./init-user-simple.sh
```

---

**祝您使用愉快！Happy Baby Tracking! 👶**

**部署版本**: 1.0.0  
**创建日期**: 2025-10-27  
**适用系统**: Debian 12 / Ubuntu 20.04+ / CentOS 8+

如有问题，请查看详细文档或运行验证脚本。

