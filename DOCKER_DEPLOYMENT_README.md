# Baby Core Docker éƒ¨ç½²è¯´æ˜

æœ¬æ–‡æ¡£æ¦‚è¿°äº† Baby Core åº”ç”¨çš„ Docker éƒ¨ç½²é…ç½®ã€‚

## ğŸ“‹ æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒé…ç½®æ–‡ä»¶

- **`Dockerfile`**: å¤šé˜¶æ®µæ„å»ºé…ç½®
  - ç¬¬ä¸€é˜¶æ®µ: æ„å»º Vue.js å‰ç«¯
  - ç¬¬äºŒé˜¶æ®µ: æ„å»º Go åç«¯
  - ç¬¬ä¸‰é˜¶æ®µ: åˆ›å»ºç²¾ç®€çš„è¿è¡Œæ—¶é•œåƒ

- **`docker-compose.yml`**: Docker Compose ç¼–æ’é…ç½®
  - å®šä¹‰ `nginx` å’Œ `baby-core` ä¸¤ä¸ªæœåŠ¡
  - é…ç½®ç½‘ç»œã€å·å’Œå¥åº·æ£€æŸ¥

- **`nginx/nginx.conf`**: Nginx åå‘ä»£ç†é…ç½®
  - å°† `/baby-core` è·¯å¾„ä»£ç†åˆ°åç«¯æœåŠ¡
  - å°† `/baby-core/api` è¯·æ±‚ä»£ç†åˆ°åç«¯ API

- **`.env.example`**: ç¯å¢ƒå˜é‡æ¨¡æ¿
  - JWT å¯†é’¥é…ç½®
  - ç«¯å£é…ç½®
  - æ•°æ®åº“è·¯å¾„é…ç½®

- **`.dockerignore`**: Docker æ„å»ºå¿½ç•¥æ–‡ä»¶
  - æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶ä»¥åŠ å¿«æ„å»ºé€Ÿåº¦

### éƒ¨ç½²è„šæœ¬

- **`deploy.sh`**: ä¸€é”®éƒ¨ç½²è„šæœ¬
  - æ£€æŸ¥ Docker ç¯å¢ƒ
  - åˆ›å»ºå¿…è¦ç›®å½•
  - æ„å»ºå’Œå¯åŠ¨æœåŠ¡
  - æ‰§è¡Œå¥åº·æ£€æŸ¥

- **`init-user-simple.sh`**: å¿«é€Ÿåˆ›å»ºé»˜è®¤ç”¨æˆ·
  - åˆ›å»ºç”¨æˆ·å `admin`ï¼Œå¯†ç  `admin123`

- **`init-user.sh`**: äº¤äº’å¼åˆ›å»ºè‡ªå®šä¹‰ç”¨æˆ·
  - å¯ä»¥æŒ‡å®šç”¨æˆ·åå’Œå¯†ç 

### æ–‡æ¡£

- **`QUICKSTART_DOCKER.md`**: 5 åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²æŒ‡å—
- **`DEPLOYMENT_DOCKER.md`**: å®Œæ•´éƒ¨ç½²æ–‡æ¡£
- **`SERVER_SETUP.md`**: ä»é›¶å¼€å§‹çš„æœåŠ¡å™¨é…ç½®æŒ‡å—
- **`DOCKER_DEPLOYMENT_README.md`**: æœ¬æ–‡ä»¶

## ğŸ—ï¸ æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·æµè§ˆå™¨                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ HTTP (ç«¯å£ 80)
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Nginx åå‘ä»£ç†                       â”‚
â”‚  - è·¯å¾„: /baby-core -> baby-core:8899           â”‚
â”‚  - è·¯å¾„: /baby-core/api -> baby-core:8899/api  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Docker ç½‘ç»œ
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Baby Core åç«¯æœåŠ¡                     â”‚
â”‚  - Go åº”ç”¨                                       â”‚
â”‚  - ç«¯å£: 8899                                    â”‚
â”‚  - é™æ€æ–‡ä»¶æœåŠ¡ + API                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ æ–‡ä»¶ç³»ç»Ÿ
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SQLite æ•°æ®åº“                        â”‚
â”‚  - è·¯å¾„: ./data/baby_tracker.db                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬è¦æ±‚

- Docker 20.10+
- Docker Compose 2.0+

### 2. éƒ¨ç½²æ­¥éª¤

```bash
# 1. å…‹éš†æˆ–ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨
cd baby-core

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env  # ä¿®æ”¹ JWT_SECRET

# 3. ä¸€é”®éƒ¨ç½²
chmod +x deploy.sh
./deploy.sh

# 4. åˆ›å»ºç”¨æˆ·
chmod +x init-user-simple.sh
./init-user-simple.sh
```

### 3. è®¿é—®åº”ç”¨

```
http://your-server-ip/baby-core
```

## ğŸ“¦ æœåŠ¡é…ç½®

### Nginx æœåŠ¡

- **é•œåƒ**: `nginx:latest`
- **ç«¯å£**: 80
- **é…ç½®æ–‡ä»¶**: `./nginx/nginx.conf`
- **æ—¥å¿—ç›®å½•**: `./nginx/logs`

### Baby Core æœåŠ¡

- **æ„å»º**: ä» `Dockerfile`
- **ç«¯å£**: 8899
- **æ•°æ®å·**: `./data` (æŒä¹…åŒ–æ•°æ®åº“)
- **ç¯å¢ƒå˜é‡**: ä» `.env` æ–‡ä»¶åŠ è½½

## ğŸ”§ é…ç½®é¡¹

### ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `PORT` | åç«¯æœåŠ¡ç«¯å£ | 8899 |
| `DB_PATH` | æ•°æ®åº“æ–‡ä»¶è·¯å¾„ | /app/data/baby_tracker.db |
| `JWT_SECRET` | JWT å¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰ | your-secret-key-change-in-production |
| `TZ` | æ—¶åŒº | Asia/Shanghai |

### ç«¯å£æ˜ å°„

| ä¸»æœºç«¯å£ | å®¹å™¨ç«¯å£ | æœåŠ¡ | è¯´æ˜ |
|---------|---------|------|------|
| 80 | 80 | nginx | å‰ç«¯è®¿é—®å…¥å£ |
| 8899 | 8899 | baby-core | åç«¯æœåŠ¡ï¼ˆå¯é€‰ç›´æ¥è®¿é—®ï¼‰ |

### è®¿é—®è·¯å¾„

| è·¯å¾„ | è¯´æ˜ |
|------|------|
| `/baby-core` | åº”ç”¨é¦–é¡µ |
| `/baby-core/login` | ç™»å½•é¡µé¢ |
| `/baby-core/api/*` | API æ¥å£ |

## ğŸ“ æ•°æ®æŒä¹…åŒ–

### æ•°æ®åº“

- **ä½ç½®**: `./data/baby_tracker.db`
- **ç±»å‹**: SQLite
- **å¤‡ä»½**: å»ºè®®å®šæœŸå¤‡ä»½æ­¤æ–‡ä»¶

### æ—¥å¿—

- **Nginx æ—¥å¿—**: `./nginx/logs/`
- **åº”ç”¨æ—¥å¿—**: é€šè¿‡ `docker-compose logs` æŸ¥çœ‹

## ğŸ” å®‰å…¨é…ç½®

### å¿…é¡»æ‰§è¡Œçš„å®‰å…¨æªæ–½

1. **ä¿®æ”¹ JWT_SECRET**
   ```bash
   # ç”Ÿæˆå¼ºå¯†ç 
   openssl rand -base64 32
   # å°†ç»“æœå†™å…¥ .env æ–‡ä»¶
   ```

2. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹ `admin` ç”¨æˆ·å¯†ç 

3. **é…ç½®é˜²ç«å¢™**
   ```bash
   sudo ufw allow 80/tcp
   sudo ufw enable
   ```

### æ¨èçš„å®‰å…¨æªæ–½

1. **é…ç½® HTTPS**
   - ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
   - å‚è€ƒ `SERVER_SETUP.md` ä¸­çš„ HTTPS é…ç½®ç« èŠ‚

2. **å®šæœŸå¤‡ä»½**
   - è®¾ç½®è‡ªåŠ¨å¤‡ä»½ä»»åŠ¡
   - ä¿ç•™å¤šä¸ªå¤‡ä»½ç‰ˆæœ¬

3. **ç›‘æ§æ—¥å¿—**
   - å®šæœŸæ£€æŸ¥è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—
   - è­¦æƒ•å¼‚å¸¸è®¿é—®æ¨¡å¼

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡æ–°æ„å»º
docker-compose up -d --build
```

### ç”¨æˆ·ç®¡ç†

```bash
# åˆ›å»ºé»˜è®¤ç”¨æˆ· (admin/admin123)
./init-user-simple.sh

# åˆ›å»ºè‡ªå®šä¹‰ç”¨æˆ·
./init-user.sh
```

### æ•°æ®ç®¡ç†

```bash
# å¤‡ä»½æ•°æ®åº“
cp data/baby_tracker.db backups/baby_tracker.db.$(date +%Y%m%d)

# æ¢å¤æ•°æ®åº“
docker-compose down
cp backups/baby_tracker.db.20251027 data/baby_tracker.db
docker-compose up -d
```

### ç»´æŠ¤

```bash
# æ¸…ç†æœªä½¿ç”¨çš„ Docker èµ„æº
docker system prune -a

# æŸ¥çœ‹ Docker ç£ç›˜ä½¿ç”¨
docker system df

# æ›´æ–°é•œåƒ
docker-compose pull
docker-compose up -d
```

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tulpn | grep -E '80|8899'

# ä¿®æ”¹ç«¯å£ï¼ˆåœ¨ docker-compose.yml ä¸­ï¼‰
```

#### 2. å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs

# æ£€æŸ¥é…ç½®æ–‡ä»¶
docker exec nginx-server nginx -t
```

#### 3. æ— æ³•è®¿é—®åº”ç”¨

```bash
# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# æµ‹è¯•è¿æ¥
curl http://localhost/baby-core/
```

#### 4. æ•°æ®åº“é”™è¯¯

```bash
# æ£€æŸ¥æ•°æ®ç›®å½•æƒé™
ls -la data/

# ä¿®å¤æƒé™
chmod 755 data/
chmod 644 data/*.db

# é‡æ–°åˆå§‹åŒ–ï¼ˆä¼šä¸¢å¤±æ•°æ®ï¼ï¼‰
docker-compose down
rm data/baby_tracker.db
docker-compose up -d
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](./QUICKSTART_DOCKER.md) - 5 åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²
- [å®Œæ•´éƒ¨ç½²æ–‡æ¡£](./DEPLOYMENT_DOCKER.md) - è¯¦ç»†çš„éƒ¨ç½²è¯´æ˜
- [æœåŠ¡å™¨é…ç½®æŒ‡å—](./SERVER_SETUP.md) - Debian 12 ä»é›¶å¼€å§‹é…ç½®
- [é¡¹ç›®ä¸» README](./README.md) - é¡¹ç›®ä»‹ç»å’ŒåŠŸèƒ½è¯´æ˜

## ğŸ¤ æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹æ—¥å¿—: `docker-compose logs -f`
2. æ£€æŸ¥æ–‡æ¡£: é˜…è¯»ç›¸å…³æ–‡æ¡£ç« èŠ‚
3. æœç´¢é—®é¢˜: Google æœç´¢é”™è¯¯ä¿¡æ¯

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-10-27
- åˆå§‹ Docker éƒ¨ç½²é…ç½®
- å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–
- Nginx åå‘ä»£ç†é…ç½®
- è‡ªåŠ¨éƒ¨ç½²è„šæœ¬
- å®Œæ•´æ–‡æ¡£é›†

---

**æ³¨æ„**: æœ¬éƒ¨ç½²æ–¹æ¡ˆé€‚ç”¨äºå°å‹åˆ°ä¸­å‹åº”ç”¨ã€‚å¯¹äºå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®è€ƒè™‘ï¼š
- ä½¿ç”¨ Kubernetes è¿›è¡Œå®¹å™¨ç¼–æ’
- é…ç½®è´Ÿè½½å‡è¡¡
- ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“ï¼ˆPostgreSQL/MySQLï¼‰
- é…ç½® CDN åŠ é€Ÿ
- å®æ–½ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ

